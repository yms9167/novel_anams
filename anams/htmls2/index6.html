<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…ë¬´ ìˆœì„œ & DAG ì¢…ì†ì„± í¸ì§‘ê¸°</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vis.js CDN for Network Graph Visualization (DAG ì‹œê°í™” ë¼ì´ë¸ŒëŸ¬ë¦¬) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    
    <style>
        /* Custom styles for better aesthetics and readability */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .priority-score {
            font-weight: 700;
            font-size: 1.5rem;
        }
        .task-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-left: 8px solid;
        }
        /* Tailwind classes for priority colors (Red/Yellow/Green) */
        .border-high { border-color: #ef4444; } /* Red-500 */
        .border-medium { border-color: #f59e0b; } /* Amber-500 */
        .border-low { border-color: #10b981; } /* Emerald-500 */
        .border-completed { border-color: #9ca3af; } /* Gray-400 */

        .bg-gradient-high { background-image: linear-gradient(to right, #fef2f2, #fee2e2); }
        .bg-gradient-medium { background-image: linear-gradient(to right, #fffdf2, #fff7d0); }
        .bg-gradient-low { background-image: linear-gradient(to right, #ecfdf5, #d1fae5); }
        .bg-gradient-completed { background-image: linear-gradient(to right, #f3f4f6, #e5e7eb); }

        /* Vis.js network container style */
        #dag-network {
            height: 500px; /* ë†’ì´ ì¦ê°€ */
            width: 100%;
            border: 1px solid #e5e7eb;
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl equivalent */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 leading-tight">â›“ï¸ DAG ì—…ë¬´ ìˆœì„œ & ì¢…ì†ì„± í¸ì§‘ê¸°</h1>
            <p class="text-gray-600 mt-2">ì—…ë¬´ ê°„ì˜ **ìˆœì„œ(Sequence)**ì™€ **í•„ìˆ˜ ì¢…ì†ì„±(DAG)**ì„ ê´€ë¦¬í•˜ë©°, ì ìˆ˜ ë° ì¢…ì†ì„± í¸ì§‘ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
        </header>
        
        <!-- 0. ê°€ì¤‘ì¹˜ ì„¤ì • í¼ -->
        <section class="mb-10 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">âš™ï¸ ìš°ì„ ìˆœìœ„ ê°€ì¤‘ì¹˜ ì„¤ì •</h2>
            <div id="weight-config" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- ì¤‘ìš”ë„ ê°€ì¤‘ì¹˜ -->
                <div>
                    <label for="weight-importance" class="block text-sm font-medium text-gray-700">ì¤‘ìš”ë„(I) ê°€ì¤‘ì¹˜</label>
                    <input type="number" id="weight-importance" min="0" value="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border text-center focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <!-- ê¸´ê¸‰ë„ ê°€ì¤‘ì¹˜ -->
                <div>
                    <label for="weight-urgency" class="block text-sm font-medium text-gray-700">ê¸´ê¸‰ë„(C) ê°€ì¤‘ì¹˜</label>
                    <input type="number" id="weight-urgency" min="0" value="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border text-center focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <!-- ì˜í–¥ë ¥ ê°€ì¤‘ì¹˜ -->
                <div>
                    <label for="weight-impact" class="block text-sm font-medium text-gray-700">ì˜í–¥ë ¥(E) ê°€ì¤‘ì¹˜</label>
                    <input type="number" id="weight-impact" min="0" value="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border text-center focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <!-- ë…¸ë ¥ ê°€ì¤‘ì¹˜ -->
                <div>
                    <label for="weight-effort" class="block text-sm font-medium text-gray-700">ë…¸ë ¥(R) ê°€ì¤‘ì¹˜ (ê°ì )</label>
                    <input type="number" id="weight-effort" min="0" value="1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border text-center focus:border-indigo-500 focus:ring-indigo-500">
                </div>
            </div>
            <p id="formula-display" class="text-xs text-gray-500 mt-3 font-semibold" aria-live="polite">
                <!-- Formula will be dynamically updated here -->
            </p>
        </section>

        <!-- 1. ì—…ë¬´ ì…ë ¥ í¼ (ì´ì „ 2ë²ˆ ì„¹ì…˜) -->
        <section class="mb-10 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">âœï¸ ìƒˆë¡œìš´ ì—…ë¬´ ì¶”ê°€</h2>
            <form id="task-form" class="space-y-4">
                <!-- ì—…ë¬´ ì´ë¦„ -->
                <div>
                    <label for="task-name" class="block text-sm font-medium text-gray-700">ì—…ë¬´ ë‚´ìš©</label>
                    <input type="text" id="task-name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="ì˜ˆ: 2024ë…„ 4ë¶„ê¸° ë³´ê³ ì„œ ì‘ì„±">
                </div>

                <!-- ì¢…ì†ì„± ì¶”ê°€ (DAG í•µì‹¬) -->
                <div>
                    <label for="dependencies" class="block text-sm font-medium text-gray-700">ì„ í–‰ ì—…ë¬´ (í•„ìˆ˜ ì¢…ì†ì„±)</label>
                    <p class="text-xs text-gray-500 mt-0.5">ì´ ì—…ë¬´ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ **ë¨¼ì € ì™„ë£Œë˜ì–´ì•¼ í•˜ëŠ”** ë‹¤ë¥¸ ì—…ë¬´ë“¤ì„ ì„ íƒí•˜ì„¸ìš”. (ì „ì´ ì¢…ì†ì„± ìë™ ì ìš©)</p>
                    <select id="dependencies" multiple class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border h-24">
                        <!-- Options will be dynamically populated -->
                    </select>
                </div>
                
                <!-- í‰ê°€ ìŠ¬ë¼ì´ë” -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- ì¤‘ìš”ë„ -->
                    <div>
                        <label for="importance" class="block text-sm font-medium text-gray-700">ì¤‘ìš”ë„ (I) [1-10]</label>
                        <input type="range" id="importance" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateSliderDisplay('importance', this.value)">
                        <output id="importance-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="importance-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ê¸´ê¸‰ë„ -->
                    <div>
                        <label for="urgency" class="block text-sm font-medium text-gray-700">ê¸´ê¸‰ë„ (C) [1-10]</label>
                        <input type="range" id="urgency" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateSliderDisplay('urgency', this.value)">
                        <output id="urgency-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="urgency-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ì˜í–¥ë ¥ -->
                    <div>
                        <label for="impact" class="block text-sm font-medium text-gray-700">ì˜í–¥ë ¥ (E) [1-10]</label>
                        <input type="range" id="impact" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateSliderDisplay('impact', this.value)">
                        <output id="impact-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="impact-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ë…¸ë ¥ -->
                    <div>
                        <label for="effort" class="block text-sm font-medium text-gray-700">ë…¸ë ¥ (R) [1-10]</label>
                        <input type="range" id="effort" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateSliderDisplay('effort', this.value)">
                        <output id="effort-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="effort-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg">
                    âœ… ìƒˆë¡œìš´ ì—…ë¬´ ì¶”ê°€
                </button>
            </form>
        </section>

        <!-- 2. ìš°ì„ ìˆœìœ„ ëª©ë¡ (ì´ì „ 3ë²ˆ ì„¹ì…˜) -->
        <section class="mb-10">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ“‹ í˜„ì¬ ì—…ë¬´ ëª©ë¡ (ìˆœìœ„ & ìƒíƒœ ìˆœì„œ)</h2>
            <div id="task-list-container" class="space-y-4">
                <!-- Tasks will be rendered here dynamically -->
                <p id="loading-message" class="text-gray-500 text-center p-8">ë¡œë”© ì¤‘...</p>
            </div>
        </section>
        
        <!-- 3. DAG ì‹œê°í™” ì˜ì—­ -->
        <section class="mt-10 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ”— ì—…ë¬´ ìˆœì„œ & ì¢…ì†ì„± ì‹œê°í™”</h2>
            <div id="dag-network">
                <!-- Graph will be drawn here -->
            </div>
            <p class="text-xs text-gray-500 mt-2">
                <strong>[ë‚¨ìƒ‰ ì‹¤ì„ ]:</strong> í•„ìˆ˜ ì¢…ì†ì„± íë¦„ (DAG). **(ì „ì´ ì¢…ì†ì„± í¬í•¨)**<br>
                <strong>[í•˜ëŠ˜ìƒ‰ ì ì„ ]:</strong> ë¯¸ì™„ë£Œ ì—…ë¬´ì˜ **ê¶Œì¥ ì‹¤í–‰ ìˆœì„œ** (ìš°ì„ ìˆœìœ„ ì ìˆ˜ ìˆœì„œ).<br>
                ë…¸ë“œë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜í”„ê°€ ê²¹ì¹˜ë©´ ë“œë˜ê·¸í•˜ì—¬ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </section>
        
        <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ (Confirm ëŒ€ì‹  ì‚¬ìš©) -->
        <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <p id="confirm-text" class="text-lg font-semibold mb-6 text-gray-800">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div class="flex justify-end space-x-3">
                    <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition">ì·¨ì†Œ</button>
                    <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">ì‚­ì œ</button>
                </div>
            </div>
        </div>
        
        <!-- ì—ëŸ¬/ì •ë³´ ëª¨ë‹¬ (Alert ëŒ€ì‹  ì‚¬ìš©) -->
        <div id="info-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <h3 id="info-title" class="text-xl font-bold mb-3 text-gray-800">ì•Œë¦¼</h3>
                <p id="info-message" class="text-md text-gray-700 mb-6">ë©”ì‹œì§€ ë‚´ìš©</p>
                <div class="flex justify-end">
                    <button id="info-ok-btn" class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">í™•ì¸</button>
                </div>
            </div>
        </div>

        <!-- ì¢…ì†ì„± í¸ì§‘ ëª¨ë‹¬ -->
        <div id="edit-dependency-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <h3 class="text-xl font-bold mb-4 text-gray-800">ğŸ”— ì¢…ì†ì„± í¸ì§‘: <span id="edit-task-name" class="text-indigo-600"></span></h3>
                
                <p class="text-sm text-gray-600 mb-3">
                    ì´ ì—…ë¬´ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ **ë¨¼ì € ì™„ë£Œë˜ì–´ì•¼ í•˜ëŠ”** ì„ í–‰ ì—…ë¬´ë“¤ì„ ì„ íƒí•˜ì„¸ìš”.
                    (ìˆœí™˜ ì¢…ì†ì„± ë°©ì§€ ë° **ì „ì´ ì¢…ì†ì„±**ì´ ìë™ ì ìš©ë©ë‹ˆë‹¤.)
                </p>

                <select id="edit-dependencies-select" multiple class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border h-40 mb-4">
                    <!-- Options will be dynamically populated (all other tasks) -->
                </select>

                <div class="flex justify-end space-x-3">
                    <button id="edit-modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition">ì·¨ì†Œ</button>
                    <button id="edit-modal-save-btn" class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">ì €ì¥ ë° ì—…ë°ì´íŠ¸</button>
                </div>
            </div>
        </div>
        
        <!-- ì ìˆ˜ í¸ì§‘ ëª¨ë‹¬ (New Feature) -->
        <div id="edit-score-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xl">
                <h3 class="text-xl font-bold mb-4 text-gray-800">âœï¸ ì—…ë¬´ ì ìˆ˜ í¸ì§‘: <span id="edit-score-task-name" class="text-indigo-600"></span></h3>
                
                <p class="text-sm text-gray-600 mb-4">
                    ìƒˆë¡œìš´ ì—…ë¬´ í™˜ê²½ì— ë§ì¶° ì´ ì—…ë¬´ì˜ ì¤‘ìš”ë„, ê¸´ê¸‰ë„, ì˜í–¥ë ¥, ë…¸ë ¥ ì ìˆ˜ë¥¼ ì¬í‰ê°€í•´ ì£¼ì„¸ìš”.
                </p>

                <div class="grid grid-cols-2 gap-4">
                    <!-- ì¤‘ìš”ë„ -->
                    <div>
                        <label for="edit-importance" class="block text-sm font-medium text-gray-700">ì¤‘ìš”ë„ (I) [1-10]</label>
                        <input type="range" id="edit-importance" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateEditSliderDisplay('importance', this.value)">
                        <output id="edit-importance-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="edit-importance-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ê¸´ê¸‰ë„ -->
                    <div>
                        <label for="edit-urgency" class="block text-sm font-medium text-gray-700">ê¸´ê¸‰ë„ (C) [1-10]</label>
                        <input type="range" id="edit-urgency" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateEditSliderDisplay('urgency', this.value)">
                        <output id="edit-urgency-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="edit-urgency-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ì˜í–¥ë ¥ -->
                    <div>
                        <label for="edit-impact" class="block text-sm font-medium text-gray-700">ì˜í–¥ë ¥ (E) [1-10]</label>
                        <input type="range" id="edit-impact" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateEditSliderDisplay('impact', this.value)">
                        <output id="edit-impact-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="edit-impact-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                    <!-- ë…¸ë ¥ -->
                    <div>
                        <label for="edit-effort" class="block text-sm font-medium text-gray-700">ë…¸ë ¥ (R) [1-10]</label>
                        <input type="range" id="edit-effort" min="1" max="10" value="5" class="mt-1 w-full" oninput="updateEditSliderDisplay('effort', this.value)">
                        <output id="edit-effort-value" class="block text-center font-bold text-indigo-600">5</output>
                        <p id="edit-effort-description" class="text-xs text-gray-500 text-center mt-1 h-12 flex items-center justify-center"></p>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button id="edit-score-modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition">ì·¨ì†Œ</button>
                    <button id="edit-score-modal-save-btn" class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">ì ìˆ˜ ì €ì¥</button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // ìƒìˆ˜ ë° ì „ì—­ ë³€ìˆ˜
        const LOCAL_STORAGE_KEY = 'priority_tasks_dag';
        const WEIGHTS_STORAGE_KEY = 'priority_weights';
        const taskForm = document.getElementById('task-form');
        const taskListContainer = document.getElementById('task-list-container');
        const loadingMessage = document.getElementById('loading-message');
        const confirmModal = document.getElementById('confirm-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const infoModal = document.getElementById('info-modal');
        const infoOkBtn = document.getElementById('info-ok-btn');
        const dependenciesSelect = document.getElementById('dependencies');
        
        const editDependencyModal = document.getElementById('edit-dependency-modal');
        const editDependenciesSelect = document.getElementById('edit-dependencies-select');
        const editModalSaveBtn = document.getElementById('edit-modal-save-btn');
        const editModalCancelBtn = document.getElementById('edit-modal-cancel-btn');
        
        const editScoreModal = document.getElementById('edit-score-modal'); // NEW
        const editScoreModalSaveBtn = document.getElementById('edit-score-modal-save-btn'); // NEW
        const editScoreModalCancelBtn = document.getElementById('edit-score-modal-cancel-btn'); // NEW


        let currentTasks = [];
        let taskToDeleteId = null;
        let taskToEditId = null; // ì¢…ì†ì„± í¸ì§‘ ID
        let taskToEditScoreId = null; // ì ìˆ˜ í¸ì§‘ ID // NEW
        
        // ì´ˆê¸° ê°€ì¤‘ì¹˜ ì„¤ì • (ì‚¬ìš©ì ì •ì˜ ê°€ëŠ¥)
        let currentWeights = { importance: 3, urgency: 3, impact: 2, effort: 1 };


        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        
        function showInfoModal(title, message) {
            document.getElementById('info-title').textContent = title;
            document.getElementById('info-message').innerHTML = message; // Use innerHTML for formatted text
            infoModal.classList.remove('hidden');
        }

        infoOkBtn.addEventListener('click', () => {
            infoModal.classList.add('hidden');
        });
        
        /**
         * 1-10 ì ìˆ˜ì— ë”°ë¥¸ ìƒì„¸ ì„¤ëª…ì„ ë°˜í™˜í•©ë‹ˆë‹¤. (ì´ì „ê³¼ ë™ì¼)
         */
        function getScoreDescription(type, score) {
            score = parseInt(score);
            let description = '';

            switch(type) {
                case 'importance':
                    // ì¤‘ìš”ë„: í•µì‹¬ ëª©í‘œ ë‹¬ì„±ì— ì–¼ë§ˆë‚˜ ê¸°ì—¬í•˜ëŠ”ê°€?
                    switch(score) {
                        case 1: description = 'ë§¤ìš° ë‚®ìŒ: ë‹¨ìˆœ ì•„ì´ë””ì–´/ì·¨ë¯¸ì„± ì—…ë¬´.'; break;
                        case 2: description = 'ë‚®ìŒ: ëª©í‘œ ë‹¬ì„±ì— ë¯¸ë¯¸í•œ ê¸°ì—¬.'; break;
                        case 3: description = 'ì•½ê°„ ë‚®ìŒ: ê°€ì¹˜ê°€ ë‚®ê±°ë‚˜ ë¶€ìˆ˜ì ì¸ ì—…ë¬´.'; break;
                        case 4: description = 'ë³´í†µ ì´í•˜: í‘œì¤€ì ì¸ ê¸°ëŒ€ì¹˜. ì¼ë°˜ì ì¸ ê°€ì¹˜ë¥¼ ì œê³µí•¨.'; break;
                        case 5: description = 'ì¤‘ê°„: í•µì‹¬ ëª©í‘œ ë‹¬ì„±ì— ë³´í†µ ê¸°ì—¬í•¨.'; break;
                        case 6: description = 'ì•½ê°„ ë†’ìŒ: ì£¼ìš” ëª©í‘œ ë‹¬ì„±ì— ê¸ì •ì ì¸ ê¸°ì—¬. ë†“ì¹˜ë©´ ì•ˆ ë  ê¸°íšŒ.'; break;
                        case 7: description = 'ë†’ìŒ: ì„±ê³µì— ë§¤ìš° ì¤‘ìš”í•œ í•µì‹¬ ìš”ì†Œ.'; break;
                        case 8: description = 'ë§¤ìš° ë†’ìŒ: ì „ì²´ í”„ë¡œì íŠ¸ì˜ ì„±ê³µì— í•„ìˆ˜ì ì¸ ì‘ì—….'; break;
                        case 9: description = 'ê²°ì •ì : ë¹„ì¦ˆë‹ˆìŠ¤ ì—°ì†ì„± ë˜ëŠ” í•µì‹¬ ê³ ê° ìœ ì¹˜ì— ê²°ì •ì .'; break;
                        case 10: description = 'ì ˆëŒ€ì  í•„ìˆ˜: ë¹„ì¦ˆë‹ˆìŠ¤ ì¡´í/ë²•ê·œ ì¤€ìˆ˜ì— ì§ê²°ë¨.'; break;
                        default: description = '';
                    }
                    break;
                case 'urgency':
                    // ê¸´ê¸‰ë„: ê¸°í•œê¹Œì§€ ë‚¨ì€ ì‹œê°„, ì‹œê°„ ì´ˆê³¼ ì‹œ ë¦¬ìŠ¤í¬ì˜ í¬ê¸°
                    switch(score) {
                        case 1: description = 'ë§¤ìš° ì—¬ìœ : ê¸°í•œ ì—†ìŒ. 6ê°œì›” ì´ìƒ ì—¬ìœ .'; break;
                        case 2: description = 'ì—¬ìœ : ì¥ê¸° í”„ë¡œì íŠ¸ ë‚´ ì—¬ìœ ë¡œìš´ ì—…ë¬´. ê¸°í•œì´ 2~3ê°œì›” ë‚¨ìŒ.'; break;
                        case 3: description = 'ì•½ê°„ ì—¬ìœ : ê¸°í•œì´ 1ê°œì›” ì´ìƒ ë‚¨ìŒ.'; break;
                        case 4: description = 'ë³´í†µ ì´í•˜: ê¸°í•œì´ 2~3ì£¼ ì •ë„ ë‚¨ìŒ.'; break;
                        case 5: description = 'ì¤‘ê°„: ê¸°í•œì´ ì•½ 1ì£¼ì¼ (5~7ì˜ì—…ì¼) ë‚¨ìŒ.'; break;
                        case 6: description = 'ì•½ê°„ ì´‰ë°•: ê¸°í•œì´ 4~6ì¼ ë‚¨ìŒ. ì¼ì • ê´€ë¦¬ê°€ í•„ìš”í•¨.'; break;
                        case 7: description = 'ì´‰ë°•: ê¸°í•œì´ 3ì¼ ì´ë‚´ë¡œ ì´‰ë°•í•¨. ë‹¤ë¥¸ ì¼ì •ì„ ì¡°ì •í•´ì•¼ í•  ìˆ˜ ìˆìŒ.'; break;
                        case 8: description = 'ë§¤ìš° ê¸‰ë°•: ê¸°í•œì´ 1~2ì¼ë¡œ ë§¤ìš° ê¸‰ë°•í•¨.'; break;
                        case 9: description = 'ì‹¬ê°: ì˜¤ëŠ˜ ì¤‘ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.'; break;
                        case 10: description = 'Critical: 24ì‹œê°„ ì´ë‚´ ë§ˆê°/ì‹¬ê°í•œ ì‹œìŠ¤í…œ ë¸”ë¡œì»¤.'; break;
                        default: description = '';
                    }
                    break;
                case 'impact':
                    // ì˜í–¥ë ¥: ê²°ê³¼ë¬¼ì´ ê³ ê°, íšŒì‚¬ ì„±ê³¼ì— ì–¼ë§ˆë‚˜ ê¸ì •ì ì¸ ë³€í™”ë¥¼ ì£¼ëŠ”ê°€?
                    switch(score) {
                        case 1: description = 'ë§¤ìš° ë¯¸ë¯¸: ì˜í–¥ë ¥ ì—†ìŒ. ê°œì¸ì˜ í¸ì˜ í–¥ìƒ ìˆ˜ì¤€.'; break;
                        case 2: description = 'ë¯¸ë¯¸: ì†Œìˆ˜ì˜ ì‚¬ìš©ì(1% ë¯¸ë§Œ)ì—ê²Œë§Œ ì‘ì€ ê°œì„ .'; break;
                        case 3: description = 'ì•½ê°„ ë¯¸ë¯¸: ì‚¬ì†Œí•œ ë²„ê·¸ ìˆ˜ì • ë˜ëŠ” ë‹¨ìˆœ UI í…ìŠ¤íŠ¸ ê°œì„ .'; break;
                        case 4: description = 'ë³´í†µ ì´í•˜: ì˜ˆìƒë˜ëŠ” ê³ ê° ë§Œì¡±ë„ ì†Œí­ ìƒìŠ¹.'; break;
                        case 5: description = 'ì¤‘ê°„: ì„œë¹„ìŠ¤ í•µì‹¬ ì‚¬ìš©ì(Active Users)ì˜ 50% ì´ìƒì—ê²Œ ëª…í™•í•œ ê°œì„  ì²´ê°.'; break;
                        case 6: description = 'ì•½ê°„ ë†’ìŒ: ì£¼ìš” ì§€í‘œ(ì˜ˆ: ì´íƒˆë¥ )ì— 3~5% ì¸¡ì • ê°€ëŠ¥í•œ ê¸ì •ì  ë³€í™”.'; break;
                        case 7: description = 'ë†’ìŒ: ì£¼ìš” KPIë¥¼ í¬ê²Œ ê°œì„ í•  ì ì¬ë ¥. ëª…í™•í•œ ì´ìµ ì°½ì¶œ.'; break;
                        case 8: description = 'ë§¤ìš° ë†’ìŒ: ì§ì ‘ì ì¸ ìˆ˜ìµ/ë§¤ì¶œ ì¦ëŒ€ì— 8% ì´ìƒ ì¤‘ëŒ€í•œ ì˜í–¥.'; break;
                        case 9: description = 'í˜ì‹ ì : íšŒì‚¬ ëª©í‘œë¥¼ ê·¹ì ìœ¼ë¡œ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” í˜ì‹ ì  ë³€í™”.'; break;
                        case 10: description = 'Game Changer: ì„œë¹„ìŠ¤ì˜ í•µì‹¬ KPIë¥¼ 15% ì´ìƒ í­ë°œì ìœ¼ë¡œ ê°œì„ í•  ìˆ˜ ìˆëŠ” ì ì¬ë ¥.'; break;
                        default: description = '';
                    }
                    break;
                case 'effort':
                    // ë…¸ë ¥: ì—…ë¬´ ì™„ë£Œì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ì™€ ì‹œê°„ (ë…¸ë ¥ì€ ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ê°ì )
                    switch(score) {
                        case 1: description = 'ë§¤ìš° ì‰¬ì›€: 1ì‹œê°„ ë¯¸ë§Œ ì†Œìš”. (ë…¸ë ¥ ì ìˆ˜ ê°ì  ìµœì†Œ)'; break;
                        case 2: description = 'ì‰¬ì›€: 1ì¼ (1ì¸ì¼) ì´ë‚´ ì†Œìš”.'; break;
                        case 3: description = 'ì•½ê°„ ì‰¬ì›€: 2ì¼ ì†Œìš”.'; break;
                        case 4: description = 'ë³´í†µ ì´í•˜: 2~3ì¼ ì†Œìš”.'; break;
                        case 5: description = 'ì¤‘ê°„: 3~5ì˜ì—…ì¼ (ì•½ 1ì¸ ì£¼) ì†Œìš”.'; break;
                        case 6: description = 'ì•½ê°„ ì–´ë ¤ì›€: 1ì£¼~1.5ì£¼ ì†Œìš”.'; break;
                        case 7: description = 'ì–´ë ¤ì›€: 1.5ì£¼~2ì£¼ ì†Œìš”.'; break;
                        case 8: description = 'ë§¤ìš° ì–´ë ¤ì›€: 3ì£¼ ì†Œìš”.'; break;
                        case 9: description = 'ëŒ€ê·œëª¨: 4ì£¼ (1ê°œì›”) ì†Œìš”. ëŒ€ê·œëª¨ ê°œë°œ/êµ¬í˜„ì´ í•„ìš”.'; break;
                        case 10: description = 'ì¥ê¸° í”„ë¡œì íŠ¸: 1ê°œì›”(4ì£¼) ì´ìƒ ì†Œìš”. (ë…¸ë ¥ ì ìˆ˜ ìµœëŒ€ ê°ì )'; break;
                        default: description = '';
                    }
                    break;
                default:
                    return '';
            }

            return `[${score}ì ] ${description}`;
        }

        /**
         * ì—…ë¬´ ì¶”ê°€ í¼ì˜ ìŠ¬ë¼ì´ë” ë””ìŠ¤í”Œë ˆì´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateSliderDisplay(id, value) {
            const valueElement = document.getElementById(`${id}-value`);
            const descElement = document.getElementById(`${id}-description`);
            if (valueElement) {
                valueElement.textContent = value;
            }
            if (descElement) {
                descElement.textContent = getScoreDescription(id, value);
            }
        }
        
        /**
         * ì ìˆ˜ í¸ì§‘ ëª¨ë‹¬ì˜ ìŠ¬ë¼ì´ë” ë””ìŠ¤í”Œë ˆì´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (NEW)
         */
        function updateEditSliderDisplay(id, value) {
            const valueElement = document.getElementById(`edit-${id}-value`);
            const descElement = document.getElementById(`edit-${id}-description`);
            if (valueElement) {
                valueElement.textContent = value;
            }
            if (descElement) {
                descElement.textContent = getScoreDescription(id, value);
            }
        }


        // --- DAG (Directed Acyclic Graph) ê´€ë ¨ í•¨ìˆ˜ ---

        /**
         * DAG ìˆœí™˜ ì¢…ì†ì„±ì„ í™•ì¸í•©ë‹ˆë‹¤. 
         */
        function checkCyclic(newDependencies, taskId) {
            // ì„ì‹œë¡œ ì¢…ì†ì„±ì„ ì—…ë°ì´íŠ¸í•œ íƒœìŠ¤í¬ ëª©ë¡ ìƒì„±
            const tempTasks = currentTasks.map(t => ({ 
                ...t, 
                dependencies: t.id === taskId ? newDependencies : t.dependencies 
            }));

            const visited = new Set();
            const recursionStack = new Set();
            let cycleFound = false;

            function dfs(currentId) {
                if (cycleFound) return;

                visited.add(currentId);
                recursionStack.add(currentId);

                const currentTask = tempTasks.find(t => t.id === currentId);
                if (currentTask && currentTask.dependencies) {
                    for (const depId of currentTask.dependencies) {
                        // ìê¸° ìì‹ ì— ì¢…ì†ë˜ëŠ” ê²ƒì€ ìˆœí™˜
                        if (depId === currentId) {
                            cycleFound = true;
                            return;
                        }
                        // ì´ë¯¸ ì¬ê·€ ìŠ¤íƒì— ìˆìœ¼ë©´ ìˆœí™˜
                        if (recursionStack.has(depId)) {
                            cycleFound = true; 
                            return;
                        }
                        // ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•Šì€ ë…¸ë“œ íƒìƒ‰
                        if (!visited.has(depId)) {
                            dfs(depId);
                        }
                    }
                }
                recursionStack.delete(currentId);
            }
            
            // ìƒˆ ì¢…ì†ì„±ì—ì„œë¶€í„° ì¶œë°œí•˜ì—¬ í˜„ì¬ íƒœìŠ¤í¬ë¡œ ëŒì•„ì˜¤ëŠ” ê²½ë¡œê°€ ìˆëŠ”ì§€ í™•ì¸
            for(const depId of newDependencies) {
                if(depId) {
                    const pathExists = (targetId) => {
                        const queue = [targetId];
                        const pathVisited = new Set();
                        while(queue.length > 0) {
                            const current = queue.shift();
                            if(current === taskId) return true;
                            if(pathVisited.has(current)) continue;
                            pathVisited.add(current);

                            const task = currentTasks.find(t => t.id === current);
                            if (task) {
                                task.dependencies.forEach(dep => queue.push(dep));
                            }
                        }
                        return false;
                    };
                    if(pathExists(depId)) return true;
                }
            }
            
            // Full graph check (safer) - If we update any task, we must check the whole graph
            tempTasks.forEach(t => {
                if (!visited.has(t.id)) {
                    dfs(t.id);
                }
            });

            return cycleFound;
        }


        /**
         * ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ì „ì´ ì¢…ì†ì„± ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤.
         */
        function applyTransitiveRule(directDependencies) {
            const transitiveDependencies = new Set(directDependencies);
            let originalSize;

            // ìƒˆë¡œìš´ ì¢…ì†ì„±ì´ ì¶”ê°€ë˜ì§€ ì•Šì„ ë•Œê¹Œì§€ ë°˜ë³µ
            do {
                originalSize = transitiveDependencies.size;
                const currentDeps = Array.from(transitiveDependencies);

                currentDeps.forEach(depId => {
                    const depTask = currentTasks.find(t => t.id === depId);
                    if (depTask) {
                        // í˜„ì¬ ì¢…ì†ì„±(B)ì˜ ì„ í–‰ ì—…ë¬´ë“¤(A)ì„ ì°¾ìŒ
                        depTask.dependencies.forEach(grandparentDepId => {
                            // Aê°€ Tì˜ ì¢…ì†ì„±ì— ì•„ì§ ì—†ë‹¤ë©´ ì¶”ê°€
                            if (!transitiveDependencies.has(grandparentDepId)) {
                                transitiveDependencies.add(grandparentDepId);
                            }
                        });
                    }
                });
            } while (transitiveDependencies.size !== originalSize); 

            // ì „ì´ ì¢…ì†ì„±ì´ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ, ë¶ˆí•„ìš”í•œ ì¤‘ë³µì„ ì œê±°í•˜ê³  ë°°ì—´ë¡œ ë°˜í™˜
            return Array.from(transitiveDependencies); 
        }

        /**
         * íŠ¹ì • ì—…ë¬´ê°€ ì‹œì‘ ê°€ëŠ¥í•œì§€ (ëª¨ë“  ì„ í–‰ ì—…ë¬´ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€) í™•ì¸í•©ë‹ˆë‹¤.
         */
        function isTaskReady(task) {
            if (task.isCompleted) return false; // ì´ë¯¸ ì™„ë£Œë˜ì—ˆìœ¼ë©´ Ready ìƒíƒœì—ì„œ ì œì™¸

            if (!task.dependencies || task.dependencies.length === 0) {
                return true; // ì¢…ì†ì„±ì´ ì—†ìœ¼ë©´ ë°”ë¡œ ì‹œì‘ ê°€ëŠ¥
            }

            return task.dependencies.every(depId => {
                const depTask = currentTasks.find(t => t.id === depId);
                // ì¢…ì†ëœ íƒœìŠ¤í¬ê°€ ì¡´ì¬í•˜ê³ (ì˜¤ë¥˜ ë°©ì§€), ê·¸ íƒœìŠ¤í¬ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                return depTask && depTask.isCompleted;
            });
        }


        // --- ì—…ë¬´ ê´€ë¦¬ í•¨ìˆ˜ ---

        function loadWeights() {
            try {
                const weightsJson = localStorage.getItem(WEIGHTS_STORAGE_KEY);
                return weightsJson ? JSON.parse(weightsJson) : { importance: 3, urgency: 3, impact: 2, effort: 1 };
            } catch (e) {
                console.error("ê°€ì¤‘ì¹˜ ë¡œë“œ ì‹¤íŒ¨:", e);
                return { importance: 3, urgency: 3, impact: 2, effort: 1 };
            }
        }

        function saveWeights(weights) {
            try {
                localStorage.setItem(WEIGHTS_STORAGE_KEY, JSON.stringify(weights));
            } catch (e) {
                console.error("ê°€ì¤‘ì¹˜ ì €ì¥ ì‹¤íŒ¨:", e);
            }
        }

        function syncWeightInputs() {
            document.getElementById('weight-importance').value = currentWeights.importance;
            document.getElementById('weight-urgency').value = currentWeights.urgency;
            document.getElementById('weight-impact').value = currentWeights.impact;
            document.getElementById('weight-effort').value = currentWeights.effort;
        }

        function setupWeightListeners() {
            const ids = ['importance', 'urgency', 'impact', 'effort'];
            ids.forEach(id => {
                const input = document.getElementById(`weight-${id}`);
                input.addEventListener('input', () => {
                    const newValue = parseInt(input.value) || 0;
                    currentWeights[id] = newValue;
                    saveWeights(currentWeights);
                    updateFormulaDisplay();
                    renderTasks(); 
                });
            });
        }

        function updateFormulaDisplay() {
            const formulaDisplay = document.getElementById('formula-display');
            const i = currentWeights.importance;
            const c = currentWeights.urgency;
            const e = currentWeights.impact;
            const r = currentWeights.effort;
            formulaDisplay.innerHTML = `
                *ìš°ì„ ìˆœìœ„ ì ìˆ˜ = (ì¤‘ìš”ë„ x${i}) + (ê¸´ê¸‰ë„ x${c}) + (ì˜í–¥ë ¥ x${e}) - (ë…¸ë ¥ x${r})
            `;
        }

        /**
         * ì—…ë¬´ì˜ ìš°ì„ ìˆœìœ„ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ê³  task ê°ì²´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
         */
        function calculatePriority(task) {
            const weights = currentWeights; 
            // ì ìˆ˜ëŠ” ë¬¸ìì—´ë¡œ ì €ì¥ë˜ë¯€ë¡œ parseIntë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
            const importance = parseInt(task.importance); 
            const urgency = parseInt(task.urgency);
            const impact = parseInt(task.impact);
            const effort = parseInt(task.effort);
            
            const score = (importance * weights.importance) + 
                          (urgency * weights.urgency) + 
                          (impact * weights.impact) - 
                          (effort * weights.effort);
            
            task.priorityScore = score;
            return score;
        }

        function loadTasks() {
            try {
                const tasksJson = localStorage.getItem(LOCAL_STORAGE_KEY);
                return tasksJson ? JSON.parse(tasksJson).map(t => ({
                    ...t,
                    isCompleted: t.isCompleted === true, 
                    dependencies: t.dependencies || [],
                    // ensure scores are strings if not present (to match form inputs)
                    importance: t.importance ? String(t.importance) : '5', 
                    urgency: t.urgency ? String(t.urgency) : '5',
                    impact: t.impact ? String(t.impact) : '5',
                    effort: t.effort ? String(t.effort) : '5',
                })) : [];
            } catch (e) {
                console.error("localStorage ë¡œë“œ ì‹¤íŒ¨:", e);
                return [];
            }
        }

        function saveTasks(tasks) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(tasks));
            } catch (e) {
                console.error("localStorage ì €ì¥ ì‹¤íŒ¨:", e);
            }
        }

        /**
         * ì—…ë¬´ ì™„ë£Œ ìƒíƒœë¥¼ í† ê¸€í•˜ê³  ì¢…ì†ëœ ì—…ë¬´ë“¤ì˜ ìƒíƒœë¥¼ ì¬ê³„ì‚°í•©ë‹ˆë‹¤.
         */
        function toggleCompletion(taskId) {
            const task = currentTasks.find(t => t.id === taskId);
            if (!task) return;

            // ì™„ë£Œëœ ì—…ë¬´ë¥¼ ë¯¸ì™„ë£Œë¡œ ë˜ëŒë¦¬ë ¤ëŠ” ê²½ìš°
            if (task.isCompleted) {
                const hasUncompletedChildren = currentTasks.some(t => 
                    !t.isCompleted && // ë¯¸ì™„ë£Œëœ ì—…ë¬´ë§Œ í™•ì¸
                    t.dependencies.includes(taskId)
                );
                
                if (hasUncompletedChildren) {
                    showInfoModal("ê²½ê³ ", "ì´ ì—…ë¬´ë¥¼ ë¯¸ì™„ë£Œ ìƒíƒœë¡œ ë˜ëŒë¦¬ë ¤ë©´, ì´ ì—…ë¬´ì— ì¢…ì†ëœ ë¯¸ì™„ë£Œ ì—…ë¬´ë“¤ì„ ë¨¼ì € ì™„ë£Œí•˜ê±°ë‚˜ ì¢…ì†ì„±ì„ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.");
                    return;
                }
            }
            
            task.isCompleted = !task.isCompleted;
            
            saveTasks(currentTasks);
            renderTasks();
        }

        /**
         * ì—…ë¬´ ëª©ë¡ì„ ìš°ì„ ìˆœìœ„, ì¤€ë¹„ ìƒíƒœ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ê³  ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderTasks() {
            // 1. ì ìˆ˜ ë° ìƒíƒœ ê³„ì‚°
            currentTasks.forEach(task => {
                calculatePriority(task);
                task.isReady = isTaskReady(task); // Ready ìƒíƒœ ì—…ë°ì´íŠ¸
            });
            
            // 2. ì •ë ¬: ë¯¸ì™„ë£Œ > ì‹œì‘ ê°€ëŠ¥ > ì ìˆ˜ ë†’ì€ ìˆœ
            currentTasks.sort((a, b) => {
                // 1. ì™„ë£Œ ìƒíƒœ (ë¯¸ì™„ë£Œê°€ ë¨¼ì €, false < true)
                if (a.isCompleted !== b.isCompleted) {
                    return a.isCompleted ? 1 : -1;
                }
                
                // 2. Ready ìƒíƒœ (Readyê°€ ë¨¼ì €, true > false)
                if (a.isReady !== b.isReady) {
                    return a.isReady ? -1 : 1;
                }

                // 3. ì ìˆ˜ (ì ìˆ˜ ë†’ì€ ìˆœ)
                return b.priorityScore - a.priorityScore;
            });

            // 3. ìˆœìœ„ (Rank) í• ë‹¹
            currentTasks.forEach((task, index) => {
                task.rank = index + 1;
            });
            
            // 4. ì¢…ì†ì„± ì…€ë ‰í„° ì—…ë°ì´íŠ¸
            renderDependencySelector();

            // 5. DOM ì—…ë°ì´íŠ¸ (ì—…ë¬´ ëª©ë¡)
            taskListContainer.innerHTML = '';
            loadingMessage.classList.add('hidden');

            if (currentTasks.length === 0) {
                taskListContainer.innerHTML = '<p class="text-gray-500 text-center p-8 bg-white rounded-xl">âœ¨ ì•„ì§ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì—…ë¬´ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
            }

            currentTasks.forEach(task => {
                const isCompleted = task.isCompleted;
                const isReady = task.isReady;
                
                // ì ìˆ˜ ê¸°ë°˜ ìƒ‰ìƒ ê²°ì • (1-10 ë²”ìœ„, ìµœëŒ€ ì ìˆ˜ ì•½ 79ì  ê¸°ì¤€)
                const priorityClass = isCompleted ? 'border-completed bg-gradient-completed' :
                                      task.priorityScore >= 55 ? 'border-high bg-gradient-high' : // 55ì  ì´ìƒ (High)
                                      task.priorityScore >= 32 ? 'border-medium bg-gradient-medium' : // 32ì  ì´ìƒ (Medium)
                                      'border-low bg-gradient-low'; // ê·¸ ì™¸ (Low)
                
                const taskCard = document.createElement('div');
                taskCard.className = `task-card flex flex-col md:flex-row md:items-center justify-between p-4 rounded-xl ${priorityClass}`;
                taskCard.dataset.id = task.id;

                const depNames = task.dependencies.map(depId => {
                    const depTask = currentTasks.find(t => t.id === depId);
                    return depTask ? depTask.name : 'ì•Œ ìˆ˜ ì—†ëŠ” ì—…ë¬´';
                });
                
                let statusBadge;
                if (isCompleted) {
                    statusBadge = '<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-gray-500 text-white">âœ… ì™„ë£Œë¨</span>';
                } else if (isReady) {
                    statusBadge = '<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-emerald-600 text-white">ğŸŸ¢ ì‹œì‘ ê°€ëŠ¥</span>';
                } else {
                    statusBadge = '<span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-yellow-500 text-white">ğŸŸ¡ ëŒ€ê¸° ì¤‘</span>';
                }

                taskCard.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center space-x-2 mb-2 md:mb-0">
                            <span class="text-xl font-bold text-gray-800">#${task.rank}</span>
                            <p class="text-lg font-semibold text-gray-900 truncate ${isCompleted ? 'line-through text-gray-500' : ''}">${task.name}</p>
                            ${statusBadge}
                        </div>
                        <div class="mt-1 text-sm text-gray-700 flex flex-wrap gap-x-4 gap-y-1">
                            <span title="Importance">I: ${task.importance}</span>
                            <span title="Urgency">C: ${task.urgency}</span>
                            <span title="Impact">E: ${task.impact}</span>
                            <span title="Effort">R: ${task.effort}</span>
                        </div>
                        ${depNames.length > 0 ? `
                            <p class="text-xs text-gray-600 mt-2 italic">
                                í•„ìˆ˜ ì„ í–‰ ì—…ë¬´: ${depNames.join(', ')}
                            </p>
                        ` : ''}
                    </div>
                    <div class="flex flex-wrap items-center space-x-3 mt-3 md:mt-0 ml-4">
                        <span class="priority-score text-gray-800">${task.priorityScore.toFixed(1)}</span>
                        
                        <!-- ì ìˆ˜ í¸ì§‘ ë²„íŠ¼ ì¶”ê°€ (NEW) -->
                        <button class="edit-score-btn px-3 py-1 text-sm font-medium rounded-lg transition duration-150 bg-blue-500 hover:bg-blue-600 text-white">
                            ì ìˆ˜ í¸ì§‘
                        </button>
                        
                        <!-- ì¢…ì†ì„± í¸ì§‘ ë²„íŠ¼ -->
                        <button class="edit-dep-btn px-3 py-1 text-sm font-medium rounded-lg transition duration-150 bg-indigo-500 hover:bg-indigo-600 text-white">
                            ì¢…ì†ì„± í¸ì§‘
                        </button>

                        <button class="toggle-btn px-3 py-1 text-sm font-medium rounded-lg transition duration-150 ${isCompleted ? 'bg-gray-400 hover:bg-gray-500 text-white' : 'bg-green-600 hover:bg-green-700 text-white'}">
                            ${isCompleted ? 'ë¯¸ì™„ë£Œë¡œ' : 'ì™„ë£Œí•˜ê¸°'}
                        </button>
                        <button class="delete-btn text-gray-500 hover:text-red-600 transition p-2 rounded-full hover:bg-gray-100" aria-label="ì—…ë¬´ ì‚­ì œ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                `;
                taskListContainer.appendChild(taskCard);
            });

            // 6. DAG ì‹œê°í™”
            drawNetwork(currentTasks);

            // 7. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ëª©ë¡ í•­ëª©)
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.closest('.task-card').dataset.id;
                    showDeleteConfirmModal(taskId);
                });
            });
            document.querySelectorAll('.toggle-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.closest('.task-card').dataset.id;
                    toggleCompletion(taskId);
                });
            });
            document.querySelectorAll('.edit-dep-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.closest('.task-card').dataset.id;
                    openEditDependencyModal(taskId);
                });
            });
            document.querySelectorAll('.edit-score-btn').forEach(button => { // NEW
                button.addEventListener('click', (e) => {
                    const taskId = e.currentTarget.closest('.task-card').dataset.id;
                    openEditScoreModal(taskId);
                });
            });
        }
        
        // --- ì ìˆ˜ í¸ì§‘ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ (NEW) ---

        function openEditScoreModal(taskId) {
            const task = currentTasks.find(t => t.id === taskId);
            if (!task) return;
            
            taskToEditScoreId = taskId;
            document.getElementById('edit-score-task-name').textContent = task.name;
            
            const fields = ['importance', 'urgency', 'impact', 'effort'];
            
            fields.forEach(field => {
                const inputElement = document.getElementById(`edit-${field}`);
                const value = task[field];
                
                // 1. input ê°’ ì„¤ì •
                inputElement.value = value;
                
                // 2. ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ì ìˆ˜ ë° ì„¤ëª…)
                updateEditSliderDisplay(field, value);
                
                // 3. ì„ì‹œ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ëª¨ë‹¬ì´ ë‹«í ë•Œ í•´ì œë˜ë¯€ë¡œ ì—¬ê¸°ì„œë§Œ ì„¤ì •)
                inputElement.oninput = function() {
                    updateEditSliderDisplay(field, this.value);
                };
            });

            editScoreModal.classList.remove('hidden');
        }

        editScoreModalSaveBtn.addEventListener('click', () => {
            const taskId = taskToEditScoreId;
            if (!taskId) return;

            const taskIndex = currentTasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // ìƒˆ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
            const newImportance = document.getElementById('edit-importance').value;
            const newUrgency = document.getElementById('edit-urgency').value;
            const newImpact = document.getElementById('edit-impact').value;
            const newEffort = document.getElementById('edit-effort').value;

            // ì—…ë¬´ ê°ì²´ ì—…ë°ì´íŠ¸
            currentTasks[taskIndex].importance = newImportance;
            currentTasks[taskIndex].urgency = newUrgency;
            currentTasks[taskIndex].impact = newImpact;
            currentTasks[taskIndex].effort = newEffort;
            
            // ìš°ì„ ìˆœìœ„ ì¬ê³„ì‚° ë° ì €ì¥
            saveTasks(currentTasks);
            renderTasks();

            // ëª¨ë‹¬ ë‹«ê¸°
            editScoreModal.classList.add('hidden');
            taskToEditScoreId = null;
        });

        editScoreModalCancelBtn.addEventListener('click', () => {
            editScoreModal.classList.add('hidden');
            taskToEditScoreId = null;
        });


        // --- ì¢…ì†ì„± í¸ì§‘ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ---

        function openEditDependencyModal(taskId) {
            const task = currentTasks.find(t => t.id === taskId);
            if (!task) return;
            
            taskToEditId = taskId;
            document.getElementById('edit-task-name').textContent = task.name;
            editDependenciesSelect.innerHTML = ''; // ì…€ë ‰í„° ì´ˆê¸°í™”

            // 1. ì˜µì…˜ ì±„ìš°ê¸°: í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì—…ë¬´ë¥¼ ì œì™¸í•œ ëª¨ë“  ë¯¸ì™„ë£Œ ì—…ë¬´
            currentTasks.filter(t => t.id !== taskId && !t.isCompleted).forEach(otherTask => {
                const option = document.createElement('option');
                option.value = otherTask.id;
                option.textContent = `#${otherTask.rank}: ${otherTask.name} (ì ìˆ˜: ${otherTask.priorityScore.toFixed(1)})`;
                
                // 2. í˜„ì¬ ì¢…ì†ì„± ìƒíƒœ ë°˜ì˜
                if (task.dependencies.includes(otherTask.id)) {
                    option.selected = true;
                }
                editDependenciesSelect.appendChild(option);
            });
            
            // ì˜µì…˜ì´ ì—†ì„ ë•Œ ì²˜ë¦¬
            if (editDependenciesSelect.options.length === 0) {
                 const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ì„ í–‰ ì—…ë¬´ ì—†ìŒ';
                option.disabled = true;
                editDependenciesSelect.appendChild(option);
            }

            editDependencyModal.classList.remove('hidden');
        }

        editModalSaveBtn.addEventListener('click', () => {
            const newDependencies = Array.from(editDependenciesSelect.selectedOptions).map(option => option.value);
            
            // 1. ìˆœí™˜ ì¢…ì†ì„± ê²€ì‚¬ (Cycle Detection)
            if (checkCyclic(newDependencies, taskToEditId)) {
                showInfoModal("ìˆœí™˜ ì˜¤ë¥˜", "ì„ íƒí•˜ì‹  ì¢…ì†ì„±ìœ¼ë¡œ ì¸í•´ ì—…ë¬´ ê°„ì˜ **ìˆœí™˜ ì¢…ì†ì„±(Cycle)**ì´ ë°œìƒí•˜ì—¬ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„ í–‰ ì—…ë¬´ ëª©ë¡ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");
                return;
            }

            // 2. ì „ì´ ì¢…ì†ì„± ê·œì¹™ ì ìš© (Transitive Rule Application)
            // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¢…ì†ì„± (B)ì„ ê¸°ë°˜ìœ¼ë¡œ, ê·¸ ì¢…ì†ì„±ì˜ ì„ í–‰ ì—…ë¬´ (A)ê¹Œì§€ ìë™ í¬í•¨
            const finalDependencies = applyTransitiveRule(newDependencies);

            // 3. ì—…ë¬´ ì—…ë°ì´íŠ¸
            const taskIndex = currentTasks.findIndex(t => t.id === taskToEditId);
            if (taskIndex !== -1) {
                currentTasks[taskIndex].dependencies = finalDependencies;
                saveTasks(currentTasks);
                renderTasks();
            }

            // 4. ëª¨ë‹¬ ë‹«ê¸°
            editDependencyModal.classList.add('hidden');
            taskToEditId = null;
        });

        editModalCancelBtn.addEventListener('click', () => {
            editDependencyModal.classList.add('hidden');
            taskToEditId = null;
        });


        /**
         * Vis.jsë¥¼ ì‚¬ìš©í•˜ì—¬ DAG ë„¤íŠ¸ì›Œí¬ë¥¼ ê·¸ë¦½ë‹ˆë‹¤.
         */
        function drawNetwork(tasks) {
            const container = document.getElementById('dag-network');
            if (container) { container.innerHTML = ''; }
            if (tasks.length === 0 || !container) { return; }

            const nodes = [];
            const edges = [];

            // 1. ë…¸ë“œ(Nodes) ë°ì´í„° ì¤€ë¹„
            tasks.forEach(task => {
                let color, statusLabel;
                
                if (task.isCompleted) {
                    color = { background: '#9ca3af', border: '#6b7280' }; // Gray (Completed)
                    statusLabel = 'âœ… ì™„ë£Œ';
                } else if (task.isReady) {
                    color = { background: '#10b981', border: '#059669' }; // Green (Ready)
                    statusLabel = 'ğŸŸ¢ ì‹œì‘ ê°€ëŠ¥';
                } else {
                    color = { background: '#f59e0b', border: '#d97706' }; // Amber (Waiting)
                    statusLabel = 'ğŸŸ¡ ëŒ€ê¸° ì¤‘';
                }

                const scoreText = `ì ìˆ˜: ${task.priorityScore.toFixed(1)}`;
                const details = `\nI:${task.importance} C:${task.urgency} E:${task.impact} R:${task.effort}`;
                
                nodes.push({
                    id: task.id,
                    label: `#${task.rank}: ${task.name}\n[${statusLabel}]`, 
                    title: `${task.name}\n${scoreText}${details}`, // Tooltip
                    color: color,
                    shape: 'box',
                    font: { color: '#ffffff', multi: 'html', size: 14 },
                    taskData: task,
                });
            });


            // 2. í•„ìˆ˜ ì¢…ì†ì„± ì—£ì§€ (Mandatory Dependencies) ì¶”ê°€ (ë‚¨ìƒ‰ ì‹¤ì„ )
            const mandatoryEdges = new Set(); 
            tasks.forEach(task => {
                task.dependencies.forEach(depId => {
                    if (tasks.find(t => t.id === depId)) {
                        const edgeKey = `${depId}-${task.id}`;
                        if (!mandatoryEdges.has(edgeKey)) {
                            edges.push({
                                from: depId,
                                to: task.id,
                                title: 'í•„ìˆ˜ ì„ í–‰ ì—…ë¬´ (DAG)',
                                arrows: { to: { enabled: true, scaleFactor: 1.2, type: 'arrow' } }, 
                                color: { color: '#4f46e5', highlight: '#3730a3', hover: '#3730a3' }, // Indigo-600 color
                                width: 3,
                                value: 10 // Hierarchy sort strength
                            });
                            mandatoryEdges.add(edgeKey);
                        }
                    }
                });
            });

            // 3. ìš°ì„ ìˆœìœ„ ìˆœì„œ ì—£ì§€ (Priority Sequence Flow) ì¶”ê°€ (í•˜ëŠ˜ìƒ‰ ì ì„ )
            const uncompletedTasks = tasks
                .filter(t => !t.isCompleted)
                .sort((a, b) => a.rank - b.rank); // Rank ìˆœìœ¼ë¡œ ì´ë¯¸ ì •ë ¬ë˜ì–´ ìˆìŒ

            for (let i = 0; i < uncompletedTasks.length - 1; i++) {
                const fromTask = uncompletedTasks[i];
                const toTask = uncompletedTasks[i + 1];

                // Check if the priority flow edge already exists as a mandatory dependency.
                const isMandatoryDep = mandatoryEdges.has(`${fromTask.id}-${toTask.id}`);

                if (!isMandatoryDep) {
                    edges.push({
                        from: fromTask.id,
                        to: toTask.id,
                        title: 'ê¶Œì¥ ì‹¤í–‰ ìˆœì„œ (ìš°ì„ ìˆœìœ„ ìˆœ)',
                        arrows: { to: { enabled: true, scaleFactor: 0.8, type: 'arrow' } },
                        color: { color: '#60a5fa', highlight: '#3b82f6', hover: '#3b82f6' }, // Blue-400 color
                        dashes: [5, 5], // Dashed line for suggested sequence
                        width: 1,
                        value: 1 // Weaker hierarchy sort strength
                    });
                }
            }


            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };

            const options = {
                interaction: {
                    zoomView: true,
                    dragNodes: true,
                    dragView: true
                },
                layout: {
                    hierarchical: {
                        direction: 'UD', 
                        sortMethod: 'directed', 
                        levelSeparation: 120, 
                        nodeSpacing: 180, 
                    }
                },
                physics: {
                    enabled: false
                },
                edges: {
                    smooth: {
                        enabled: true,
                        type: 'cubicBezier',
                        forceDirection: 'vertical',
                        roundness: 0.4
                    }
                }
            };

            const network = new vis.Network(container, data, options);
            
            network.on("click", function (params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    const clickedNode = nodes.find(n => n.id === nodeId);
                    if (clickedNode && clickedNode.taskData) {
                        const task = clickedNode.taskData;
                        const depNames = task.dependencies.map(depId => {
                            const depTask = tasks.find(t => t.id === depId);
                            return depTask ? depTask.name : 'ì•Œ ìˆ˜ ì—†ëŠ” ì—…ë¬´';
                        }).join(', ');
                        
                        showInfoModal(
                            `ì—…ë¬´ ìƒì„¸ ì •ë³´ (#${task.rank})`,
                            `
                            <strong class="text-indigo-600">${task.name}</strong><br>
                            <span class="text-lg font-bold">ìš°ì„ ìˆœìœ„ ì ìˆ˜: ${task.priorityScore.toFixed(1)}</span><br>
                            <strong>ìƒíƒœ:</strong> ${task.isCompleted ? 'âœ… ì™„ë£Œë¨' : task.isReady ? 'ğŸŸ¢ ì‹œì‘ ê°€ëŠ¥' : 'ğŸŸ¡ ëŒ€ê¸° ì¤‘'}<br>
                            <hr class="my-2 border-gray-200">
                            <strong>I (ì¤‘ìš”ë„):</strong> ${task.importance}<br>
                            <strong>C (ê¸´ê¸‰ë„):</strong> ${task.urgency}<br>
                            <strong>E (ì˜í–¥ë ¥):</strong> ${task.impact}<br>
                            <strong>R (ë…¸ë ¥):</strong> ${task.effort}<br>
                            <hr class="my-2 border-gray-200">
                            <strong>í•„ìˆ˜ ì„ í–‰ ì—…ë¬´:</strong> ${depNames || 'ì—†ìŒ'}
                            `
                        );
                    }
                }
            });
        }


        // --- ì¢…ì†ì„± ì…€ë ‰í„° ë Œë”ë§ í•¨ìˆ˜ ---
        function renderDependencySelector() {
            dependenciesSelect.innerHTML = '';
            
            // ëª¨ë“  ë¯¸ì™„ë£Œ ì—…ë¬´ë¥¼ ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€
            currentTasks.filter(t => !t.isCompleted).forEach(task => {
                const option = document.createElement('option');
                option.value = task.id;
                option.textContent = `#${task.rank}: ${task.name} (ì ìˆ˜: ${task.priorityScore.toFixed(1)})`;
                dependenciesSelect.appendChild(option);
            });

            // ì˜µì…˜ì´ ì—†ì„ ë•Œ (ì•„ì§ ì—…ë¬´ê°€ ì—†ì„ ë•Œ)
            if (dependenciesSelect.options.length === 0) {
                 const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ì„ í–‰ ì—…ë¬´ ì—†ìŒ';
                option.disabled = true;
                option.selected = true;
                dependenciesSelect.appendChild(option);
            }
        }


        // --- ê¸°íƒ€ í•¨ìˆ˜ (ì‚­ì œ ëª¨ë‹¬) ---

        function showDeleteConfirmModal(taskId) {
            // ì´ ì—…ë¬´ë¥¼ ì„ í–‰ ì¡°ê±´ìœ¼ë¡œ ê°€ì§€ëŠ” ìì‹ íƒœìŠ¤í¬ê°€ ìˆëŠ”ì§€ í™•ì¸
            const hasChildren = currentTasks.some(t => t.dependencies.includes(taskId));

            if (hasChildren) {
                showInfoModal("ì‚­ì œ ë¶ˆê°€", "ì´ ì—…ë¬´ë¥¼ ì‚­ì œí•˜ë ¤ë©´, ë¨¼ì € ì´ ì—…ë¬´ì— **ì¢…ì†ëœ** ë‹¤ë¥¸ ëª¨ë“  ì—…ë¬´ì˜ ì¢…ì†ì„± ëª©ë¡ì—ì„œ ì´ ì—…ë¬´ë¥¼ ì œê±°í•˜ê±°ë‚˜ ì‚­ì œí•´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            taskToDeleteId = taskId;
            document.getElementById('confirm-text').textContent = 'ì„ íƒí•˜ì‹  ì—…ë¬´ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ ì—…ë¬´ì— ì¢…ì†ëœ ì—…ë¬´ëŠ” ì—†ìŠµë‹ˆë‹¤.)';
            confirmModal.classList.remove('hidden');
        }

        function deleteTask() {
            if (!taskToDeleteId) return;

            const hasChildren = currentTasks.some(t => t.dependencies.includes(taskToDeleteId));
            if (hasChildren) {
                 showInfoModal("ì˜¤ë¥˜", "ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ ì—…ë¬´ë¥¼ ì„ í–‰ ì—…ë¬´ë¡œ ì§€ì •í•œ ë‹¤ë¥¸ ì—…ë¬´ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
                 confirmModal.classList.add('hidden');
                 taskToDeleteId = null;
                 return;
            }

            currentTasks = currentTasks.filter(task => task.id !== taskToDeleteId);
            
            saveTasks(currentTasks);
            renderTasks();

            taskToDeleteId = null;
            confirmModal.classList.add('hidden');
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

        // 1. ì—…ë¬´ ì¶”ê°€ í¼ ì œì¶œ ì²˜ë¦¬
        taskForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const taskName = document.getElementById('task-name').value.trim();
            if (!taskName) return;
            
            // ì ìˆ˜ëŠ” ë¬¸ìì—´ë¡œ ì €ì¥
            const importanceValue = document.getElementById('importance').value;
            const urgencyValue = document.getElementById('urgency').value;
            const impactValue = document.getElementById('impact').value;
            const effortValue = document.getElementById('effort').value;
            
            const selectedDependencies = Array.from(dependenciesSelect.selectedOptions).map(option => option.value);

            // 1. ì „ì´ ì¢…ì†ì„± ê·œì¹™ ì ìš© (Transitive Rule Application)
            const finalDependencies = applyTransitiveRule(selectedDependencies);

            const newTask = {
                id: crypto.randomUUID(), 
                name: taskName,
                importance: importanceValue,
                urgency: urgencyValue,
                impact: impactValue,
                effort: effortValue,
                isCompleted: false, 
                dependencies: finalDependencies, // ì „ì´ ê·œì¹™ì´ ì ìš©ëœ ì¢…ì†ì„±
            };

            currentTasks.push(newTask);
            
            saveTasks(currentTasks);
            renderTasks();

            // í¼ ì´ˆê¸°í™”
            taskForm.reset();
            document.getElementById('importance').value = 5; 
            document.getElementById('urgency').value = 5;   
            document.getElementById('impact').value = 5;    
            document.getElementById('effort').value = 5;    
            updateSliderDisplay('importance', '5');
            updateSliderDisplay('urgency', '5');
            updateSliderDisplay('impact', '5');
            updateSliderDisplay('effort', '5');
        });

        // 2. ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸
        modalConfirmBtn.addEventListener('click', deleteTask);
        modalCancelBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            taskToDeleteId = null;
        });
        
        // 3. í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
        window.onload = function() {
            // 1. ê°€ì¤‘ì¹˜ ë¡œë“œ ë° ì„¤ì •
            currentWeights = loadWeights();
            syncWeightInputs();
            updateFormulaDisplay();
            setupWeightListeners(); 
            
            // 2. ì—…ë¬´ ë¡œë“œ ë° ë Œë”ë§
            currentTasks = loadTasks();
            renderTasks();
            
            // 3. ì´ˆê¸° ë¡œë“œ ì‹œ ìŠ¬ë¼ì´ë” ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            const sliders = ['importance', 'urgency', 'impact', 'effort'];
            sliders.forEach(id => {
                // `updateSliderDisplay`ëŠ” ì¶”ê°€ í¼ì˜ ìŠ¬ë¼ì´ë”ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                updateSliderDisplay(id, document.getElementById(id).value); 
            });
        };

    </script>
</body>
</html>
