<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…ë¬´ ìš°ì„ ìˆœìœ„ ì •ë¦¬ê¸°</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics and readability */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .priority-score {
            font-weight: 700;
            font-size: 1.5rem;
        }
        .task-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-left: 8px solid;
        }
        .bg-gradient-high {
            background-image: linear-gradient(to right, #fef2f2, #fee2e2); /* Red tones for high priority */
        }
        .bg-gradient-medium {
            background-image: linear-gradient(to right, #fffdf2, #fff7d0); /* Yellow tones for medium priority */
        }
        .bg-gradient-low {
            background-image: linear-gradient(to right, #f0fdf4, #dcfce7); /* Green tones for low priority */
        }
        /* Color based on priority calculation (for border) */
        .border-high { border-left-color: #ef4444; } /* Red */
        .border-medium { border-left-color: #f59e0b; } /* Orange */
        .border-low { border-left-color: #10b981; } /* Green */
    </style>
    <!-- Firebase SDK ë¡œë“œ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, setDoc, deleteDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firestore ë¡œê¹… í™œì„±í™” (ë””ë²„ê¹…ìš©)
        setLogLevel('Debug');

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (Canvas í™˜ê²½ì—ì„œ ì œê³µë¨)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let isFirebaseConfigMissing = false;

        if (Object.keys(firebaseConfig).length === 0) {
            console.error("Firebase config is missing. Task persistence will not work.");
            document.getElementById('task-list-container').innerHTML = '<p class="text-red-500 text-center p-4">Firebase ì„¤ì •ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ì‘ì—…ì„ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            // Firebase ì„¤ì •ì´ ì—†ìœ¼ë©´ ë‚˜ë¨¸ì§€ ë¡œì§ì„ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
            document.getElementById('task-form').style.display = 'none';
            isFirebaseConfigMissing = true;
            // return; // <-- ì´ returnì´ ëª¨ë“ˆ ìŠ¤ì½”í”„ì—ì„œ ì‚¬ìš©ë  ë•Œ SyntaxErrorë¥¼ ìœ ë°œí–ˆìŠµë‹ˆë‹¤.
        }

        // Firebase ì„¤ì •ì´ ëˆ„ë½ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì•±ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
        let app, db, auth;
        if (!isFirebaseConfigMissing) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
        }
        
        let userId = null;
        let tasksCollectionRef = null;

        // --- 1. ìš°ì„ ìˆœìœ„ ê³„ì‚° ë¡œì§ (í•µì‹¬) ---
        
        /**
         * ì¤‘ìš”ë„, ê¸´ê¸‰ë„, ì˜í–¥ë ¥, ë…¸ë ¥ ê°’ê³¼ ê°€ì¤‘ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìµœì¢… ìš°ì„ ìˆœìœ„ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
         * @param {object} task - ì—…ë¬´ì˜ í‰ê°€ ê¸°ì¤€ (importance, urgency, impact, effort)
         * @param {object} weights - ê° ê¸°ì¤€ì— ì ìš©í•  ê°€ì¤‘ì¹˜
         * @returns {number} ê³„ì‚°ëœ ìš°ì„ ìˆœìœ„ ì ìˆ˜
         */
        function calculatePriority(task, weights) {
            const score = 
                (task.importance * weights.importance) +
                (task.urgency * weights.urgency) +
                (task.impact * weights.impact) - 
                (task.effort * weights.effort); // ë…¸ë ¥ì€ ê°ì  ì²˜ë¦¬
            
            return score; 
        }

        // --- 2. Firestore ë° ì¸ì¦ ì„¤ì • ---

        // Firebase ì„¤ì •ì´ ìˆì„ ë•Œë§Œ ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        if (!isFirebaseConfigMissing) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    initializeAppServices();
                } else if (initialAuthToken) {
                    try {
                        // Custom Tokenìœ¼ë¡œ ë¡œê·¸ì¸
                        const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                        userId = userCredential.user.uid;
                        initializeAppServices();
                    } catch (error) {
                        console.error("Custom Token ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);
                        showMessage("ë¡œê·¸ì¸ ì˜¤ë¥˜: ì‚¬ìš©ì ì¸ì¦ í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìµëª… ë¡œê·¸ì¸ ì‹œë„...", 'bg-orange-500');
                        // ì‹¤íŒ¨ ì‹œ ìµëª… ë¡œê·¸ì¸ ì‹œë„
                        try {
                            await signInAnonymously(auth);
                        } catch (anonError) {
                            console.error("ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨:", anonError);
                            showMessage("ì¹˜ëª…ì  ì˜¤ë¥˜: ì¸ì¦ì— ì™„ì „íˆ ì‹¤íŒ¨í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'bg-red-700');
                        }
                    }
                } else {
                    // í† í°ì´ ì—†ìœ¼ë©´ ìµëª… ë¡œê·¸ì¸
                    try {
                        await signInAnonymously(auth);
                    } catch (anonError) {
                        console.error("ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨:", anonError);
                        showMessage("ì¹˜ëª…ì  ì˜¤ë¥˜: ìµëª… ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'bg-red-700');
                    }
                }
            });
        }
        
        function initializeAppServices() {
             // userIdê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ì¢…ë£Œ
             if (!userId) { 
                return;
             }
             
             // Private data path: /artifacts/{appId}/users/{userId}/tasks
             const collectionPath = `artifacts/${appId}/users/${userId}/tasks`;
             tasksCollectionRef = collection(db, collectionPath);
             
             document.getElementById('user-id-display').textContent = `ì‚¬ìš©ì ID: ${userId}`;
             
             // ë°ì´í„° ì‹¤ì‹œê°„ ê°ì§€ ì‹œì‘ ë° ì´ˆê¸° ê³µì‹ í‘œì‹œ
             startRealtimeListener();
             // ì´ˆê¸° ê³µì‹ í‘œì‹œ (DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰)
             setTimeout(updateFormulaDisplay, 100); 
             
             // ê°€ì¤‘ì¹˜ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ê³µì‹ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
             document.querySelectorAll('.weight-input').forEach(input => {
                 input.addEventListener('input', updateFormulaDisplay);
             });
        }

        // --- 3. CRUD ë° ì‹¤ì‹œê°„ ê°ì§€ í•¨ìˆ˜ ---

        // ìƒˆ ì‘ì—… ì¶”ê°€/ì—…ë°ì´íŠ¸
        async function addTask(e) {
            e.preventDefault();
            // Firebase ì„¤ì • ëˆ„ë½ ë° Firestore ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸
            if (isFirebaseConfigMissing) {
                showMessage("Firebase ì„¤ì •ì´ ì—†ì–´ ì—…ë¬´ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'bg-red-500');
                return;
            }
            if (!tasksCollectionRef) {
                console.error("Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ì¸ì¦ì„ í™•ì¸í•˜ì„¸ìš”.");
                showMessage("ì¸ì¦ ë¬¸ì œë¡œ ì—…ë¬´ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.", 'bg-red-500');
                return;
            }

            const taskName = document.getElementById('task-name').value.trim();
            if (!taskName) {
                showMessage("ì—…ë¬´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'bg-red-500');
                return;
            }

            // ëª¨ë“  í‰ê°€ ê¸°ì¤€ ê°’ ê°€ì ¸ì˜¤ê¸° (5ì  ì²™ë„)
            const importance = parseInt(document.getElementById('importance').value);
            const urgency = parseInt(document.getElementById('urgency').value);
            const impact = parseInt(document.getElementById('impact').value);
            const effort = parseInt(document.getElementById('effort').value);
            
            // í˜„ì¬ ê°€ì¤‘ì¹˜ ê°€ì ¸ì˜¤ê¸° (ìƒˆë¡œ ì¶”ê°€)
            const currentWeights = {
                importance: parseInt(document.getElementById('importance-weight').value) || 0,
                urgency: parseInt(document.getElementById('urgency-weight').value) || 0,
                impact: parseInt(document.getElementById('impact-weight').value) || 0,
                effort: parseInt(document.getElementById('effort-weight').value) || 0,
            };

            const newTask = {
                name: taskName,
                importance: importance,
                urgency: urgency,
                impact: impact,
                effort: effort,
                createdAt: Date.now(),
                // ê°€ì¤‘ì¹˜ë¥¼ ë¬¸ì„œì— ì €ì¥í•˜ì—¬, ë‚˜ì¤‘ì— ìˆ˜ì‹ì„ ë³€ê²½í•˜ë”ë¼ë„ ê¸°ì¡´ ë¬¸ì„œì˜ ì ìˆ˜ëŠ” ìœ ì§€ë  ìˆ˜ ìˆë„ë¡ í•¨ (ì¼ê´€ì„± ìœ ì§€)
                weights: currentWeights 
            };

            // ìš°ì„ ìˆœìœ„ ì ìˆ˜ ê³„ì‚° ë° ì €ì¥ (ê°€ì¤‘ì¹˜ ì „ë‹¬)
            newTask.priorityScore = calculatePriority(newTask, currentWeights);
            
            // ê³µì‹ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì—…ë¬´ë¥¼ ì¶”ê°€í•  ë•Œ ì‚¬ìš©ëœ ê°€ì¤‘ì¹˜ ë°˜ì˜)
            updateFormulaDisplay(currentWeights);

            try {
                // Firestoreì— ìƒˆ ë¬¸ì„œ ì¶”ê°€
                await setDoc(doc(tasksCollectionRef), newTask);
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('task-form').reset();
                // ê°€ì¤‘ì¹˜ ì…ë ¥ê°’ì€ ìœ ì§€ë˜ë„ë¡ ë¦¬ì…‹ì—ì„œ ì œì™¸ (ì„ íƒì )
                
                showMessage("ìƒˆ ì—…ë¬´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.", 'bg-green-500');
            } catch (error) {
                console.error("ì—…ë¬´ ì¶”ê°€ ì˜¤ë¥˜:", error);
                showMessage("ì—…ë¬´ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (Firestore ê¶Œí•œ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)", 'bg-red-500');
            }
        }
        
        // Firebase ì„¤ì •ì´ ìˆì„ ë•Œë§Œ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        if (!isFirebaseConfigMissing) {
            document.getElementById('task-form').addEventListener('submit', addTask);
        } else {
             // í¼ ì œì¶œì„ ë§‰ì•„ì„œ ì˜¤ë¥˜ ë°©ì§€
             document.getElementById('task-form').addEventListener('submit', (e) => {
                e.preventDefault();
                showMessage("Firebase ì„¤ì •ì´ ì—†ì–´ ì—…ë¬´ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'bg-red-500');
             });
        }

        // ì‘ì—… ì‚­ì œ
        window.deleteTask = async function(taskId) {
            if (!tasksCollectionRef) return console.error("Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            
            // ì»¤ìŠ¤í…€ ëª¨ë‹¬ë¡œ ëŒ€ì²´
            showConfirmModal("ì´ ì—…ë¬´ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", async () => {
                try {
                    await deleteDoc(doc(db, tasksCollectionRef.path, taskId));
                    showMessage("ì—…ë¬´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", 'bg-yellow-500');
                } catch (error) {
                    console.error("ì—…ë¬´ ì‚­ì œ ì˜¤ë¥˜:", error);
                    showMessage("ì—…ë¬´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", 'bg-red-500');
                }
            });
        };

        // ì‘ì—… ì™„ë£Œ ìƒíƒœ í† ê¸€ (ì˜ˆì‹œë¡œ ì¶”ê°€)
        window.toggleCompleted = async function(taskId, isCompleted) {
            if (!tasksCollectionRef) return console.error("Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            
            try {
                await updateDoc(doc(db, tasksCollectionRef.path, taskId), {
                    completed: !isCompleted
                });
            } catch (error) {
                console.error("ì—…ë¬´ ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:", error);
                showMessage("ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", 'bg-red-500');
            }
        };


        // --- 4. UI ë Œë”ë§ ë° ì‹¤ì‹œê°„ ê°ì§€ ---
        
        function startRealtimeListener() {
            if (!tasksCollectionRef) return;

            // ì¿¼ë¦¬ ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬í•©ë‹ˆë‹¤. (Firestore orderBy ì´ìŠˆ ë°©ì§€)
            onSnapshot(tasksCollectionRef, (snapshot) => {
                const tasks = [];
                snapshot.forEach(doc => {
                    const task = doc.data();
                    task.id = doc.id;
                    
                    // ê¸°ì¡´ ë°ì´í„° ë˜ëŠ” ê°€ì¤‘ì¹˜ê°€ ì—†ëŠ” ë°ì´í„°ì˜ ê²½ìš° ê¸°ë³¸ ê°€ì¤‘ì¹˜(3,3,2,1)ë¡œ ì¬ê³„ì‚°
                    if (typeof task.priorityScore === 'undefined' || !task.weights) {
                         const defaultWeights = { importance: 3, urgency: 3, impact: 2, effort: 1 };
                         task.priorityScore = calculatePriority(task, defaultWeights);
                    }
                    // í˜„ì¬ ê°€ì¤‘ì¹˜ ì„¤ì •ê°’ì„ ë°˜ì˜í•˜ì—¬ ì ìˆ˜ë¥¼ ì¬ê³„ì‚°í•˜ëŠ” ëŒ€ì‹ ,
                    // ë¬¸ì„œì— ì €ì¥ëœ priorityScoreë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. (ì¼ê´€ì„± ìœ ì§€)
                    
                    tasks.push(task);
                });

                // 1. ìš°ì„ ìˆœìœ„ ì ìˆ˜ê°€ ë†’ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬
                tasks.sort((a, b) => b.priorityScore - a.priorityScore);
                
                // 2. ì™„ë£Œëœ í•­ëª©ì€ ëª©ë¡ ë§¨ ë’¤ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
                tasks.sort((a, b) => (a.completed === b.completed) ? 0 : a.completed ? 1 : -1);

                renderTasks(tasks);
            }, (error) => {
                console.error("Firestore ì‹¤ì‹œê°„ ê°ì§€ ì˜¤ë¥˜:", error);
                showMessage("ë°ì´í„° ë¡œë“œì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", 'bg-red-500');
            });
        }

        function getPriorityStyle(score) {
            // ì ìˆ˜ì— ë”°ë¼ ìŠ¤íƒ€ì¼ ê²°ì • (ì˜ˆì‹œ ê¸°ì¤€: ìµœê³ ì  25ì , ìµœì €ì  -5ì  ê°€ì •)
            if (score >= 12) { // ë†’ì€ ìš°ì„ ìˆœìœ„ (High)
                return { class: 'border-high bg-gradient-high', label: 'ìµœìš°ì„  (A)' };
            } else if (score >= 6) { // ì¤‘ê°„ ìš°ì„ ìˆœìœ„ (Medium)
                return { class: 'border-medium bg-gradient-medium', label: 'ì¤‘ìš” (B)' };
            } else { // ë‚®ì€ ìš°ì„ ìˆœìœ„ (Low)
                return { class: 'border-low bg-gradient-low', label: 'ì¼ë°˜/ë³´ë¥˜ (C)' };
            }
        }

        function renderTasks(tasks) {
            const container = document.getElementById('task-list-container');
            container.innerHTML = '';

            if (tasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center p-8">ì•„ì§ ë“±ë¡ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì—…ë¬´ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”! ğŸš€</p>';
                return;
            }

            tasks.forEach(task => {
                const style = getPriorityStyle(task.priorityScore);
                const isCompleted = task.completed || false;
                
                // í•´ë‹¹ ì—…ë¬´ì— ì ìš©ëœ ê°€ì¤‘ì¹˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. (task.weightsê°€ ìˆë‹¤ë©´)
                const weights = task.weights || { importance: 3, urgency: 3, impact: 2, effort: 1 };
                const formulaDisplay = `(ì¤‘ìš”ë„ x${weights.importance}) + (ê¸´ê¸‰ë„ x${weights.urgency}) + (ì˜í–¥ë ¥ x${weights.impact}) - (ë…¸ë ¥ x${weights.effort})`;

                const taskCard = `
                    <div class="task-card ${style.class} p-4 mb-4 rounded-xl flex items-center justify-between transition-all duration-300 ${isCompleted ? 'opacity-50 line-through' : ''}">
                        <div class="flex-1 min-w-0 pr-4">
                            <h3 class="text-lg font-semibold text-gray-800 break-words">${task.name}</h3>
                            <div class="text-sm text-gray-600 mt-1 space-y-0.5">
                                <p><strong>ì ìˆ˜:</strong> <span class="priority-score ${style.class.includes('high') ? 'text-red-600' : style.class.includes('medium') ? 'text-orange-500' : 'text-green-600'}">${task.priorityScore}ì </span> (${style.label})</p>
                                <p>í‰ê°€ ê¸°ì¤€: ì¤‘ìš”ë„(${task.importance}), ê¸´ê¸‰ë„(${task.urgency}), ì˜í–¥ë ¥(${task.impact}), ë…¸ë ¥(${task.effort})</p>
                                <p class="text-xs text-gray-500">ê³„ì‚° ê³µì‹: ${formulaDisplay}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <!-- ì™„ë£Œ ë²„íŠ¼ -->
                            <button onclick="toggleCompleted('${task.id}', ${isCompleted})" 
                                class="p-2 rounded-full transition-colors duration-200 
                                ${isCompleted ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}"
                                title="${isCompleted ? 'ì™„ë£Œ ì·¨ì†Œ' : 'ì™„ë£Œ'}"
                            >
                                <!-- Checkmark SVG Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.052-.143Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <!-- ì‚­ì œ ë²„íŠ¼ -->
                            <button onclick="deleteTask('${task.id}')" 
                                class="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors duration-200"
                                title="ì‚­ì œ"
                            >
                                <!-- Trash Can SVG Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.5H2.75a.75.75 0 0 0 0 1.5h1.163l1.82 11.23a2.75 2.75 0 0 0 2.748 2.262h6.434a2.75 2.75 0 0 0 2.748-2.262l1.82-11.23h1.163a.75.75 0 0 0 0-1.5H14v-.5A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4a.75.75 0 0 0-.75.75v7.5a.75.75 0 0 0 1.5 0v-7.5A.75.75 0 0 0 10 4Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', taskCard);
            });
        }
        
        // ê³µì‹ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ ìœ í‹¸ë¦¬í‹° (ìƒˆë¡œ ì¶”ê°€)
        function updateFormulaDisplay(weights = null) {
            let currentWeights;
            
            // ì¸ìˆ˜ë¡œ ê°€ì¤‘ì¹˜ê°€ ì œê³µë˜ë©´ ì‚¬ìš© (ì£¼ë¡œ addTaskì—ì„œ)
            if (weights) {
                currentWeights = weights;
            } 
            // ì•„ë‹ˆë©´ DOMì—ì„œ í˜„ì¬ ì„¤ì •ê°’ ì½ê¸° (ì£¼ë¡œ ì´ˆê¸° ë¡œë”©ì´ë‚˜ input ë³€ê²½ ì‹œ)
            else {
                // DOMì—ì„œ ê°’ì„ ì½ì„ ìˆ˜ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ì‚¬ìš© (ì´ˆê¸° ë¡œë“œ ì‹œ DOM ìš”ì†Œê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„)
                const importanceInput = document.getElementById('importance-weight');
                
                currentWeights = {
                    importance: importanceInput ? parseInt(importanceInput.value) : 3,
                    urgency: importanceInput ? parseInt(document.getElementById('urgency-weight').value) : 3,
                    impact: importanceInput ? parseInt(document.getElementById('impact-weight').value) : 2,
                    effort: importanceInput ? parseInt(document.getElementById('effort-weight').value) : 1,
                };
            }
            
            const formulaElement = document.getElementById('formula-display');
            if (formulaElement) {
                formulaElement.innerHTML = `
                    *ìš°ì„ ìˆœìœ„ ì ìˆ˜ = (ì¤‘ìš”ë„ x${currentWeights.importance}) + (ê¸´ê¸‰ë„ x${currentWeights.urgency}) + (ì˜í–¥ë ¥ x${currentWeights.impact}) - (ë…¸ë ¥ x${currentWeights.effort})
                `;
                // ì ‘ê·¼ì„± ê°œì„ ì„ ìœ„í•´ ê³µì‹ ì—…ë°ì´íŠ¸ ì‹œ ì•Œë¦¼
                formulaElement.setAttribute('aria-live', 'polite');
            }
        }


        // --- 5. ìœ í‹¸ë¦¬í‹° (ë©”ì‹œì§€ ë° ëª¨ë‹¬) ---

        // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, className) {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            messageBox.className = `p-3 rounded-xl text-white text-center mb-4 ${className} transition-opacity duration-300`;
            messageBox.style.opacity = '1';

            setTimeout(() => {
                messageBox.style.opacity = '0';
            }, 3000);
        }

        // ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬
        let resolveConfirm;
        const confirmModal = document.getElementById('confirm-modal');
        const confirmText = document.getElementById('confirm-text');
        const confirmYes = document.getElementById('confirm-yes');
        const confirmNo = document.getElementById('confirm-no');

        function showConfirmModal(text, onConfirm) {
            confirmText.textContent = text;
            confirmModal.classList.remove('hidden');
            
            confirmYes.onclick = () => {
                confirmModal.classList.add('hidden');
                onConfirm();
            };
            
            confirmNo.onclick = () => {
                confirmModal.classList.add('hidden');
            };
        }


    </script>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 border-b-4 border-indigo-500 pb-2">
            âœ… ì—…ë¬´ ìš°ì„ ìˆœìœ„ ì •ë¦¬ê¸°
        </h1>
        <p class="text-gray-600 mb-6">
            í‰ê°€ ê¸°ì¤€ì— ë”°ë¼ ì ìˆ˜ë¥¼ ë§¤ê¸°ê³ , ê°ê´€ì ì¸ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì—…ë¬´ë¥¼ ì •ë¦¬í•˜ì„¸ìš”.
        </p>
        
        <div id="user-id-display" class="text-xs text-gray-400 mb-4"></div>

        <!-- ë©”ì‹œì§€ ë°•ìŠ¤ -->
        <div id="message-box" class="p-3 rounded-xl text-white text-center mb-4 opacity-0 transition-opacity duration-300"></div>

        <!-- 1. ìƒˆ ì—…ë¬´ ì¶”ê°€ í¼ -->
        <section class="mb-8 p-6 bg-indigo-50 rounded-xl shadow-inner">
            <h2 class="text-xl font-bold text-indigo-700 mb-4">ìƒˆ ì—…ë¬´ ì¶”ê°€ ë° í‰ê°€</h2>
            <form id="task-form" class="space-y-4">
                <!-- ì—…ë¬´ ì´ë¦„ -->
                <div>
                    <label for="task-name" class="block text-sm font-medium text-gray-700 mb-1">ì—…ë¬´ ì´ë¦„</label>
                    <input type="text" id="task-name" required placeholder="ì˜ˆ: 2ë¶„ê¸° í•µì‹¬ í”„ë¡œì íŠ¸ ìµœì¢… ë³´ê³ ì„œ ì œì¶œ"
                        class="w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <!-- í‰ê°€ ê¸°ì¤€ ì„¹ì…˜ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    
                    <!-- ì¤‘ìš”ë„ (Importance) - í™•ì¥ë¨ -->
                    <div>
                        <label for="importance" class="block text-sm font-medium text-gray-700 mb-1">1. ì¤‘ìš”ë„ (ëª©í‘œ ê¸°ì—¬ë„ ë° ë¦¬ìŠ¤í¬)</label>
                        <select id="importance" required class="w-full p-3 border border-indigo-300 rounded-lg bg-white text-sm focus:ring-2 focus:ring-indigo-500">
                            <option value="5">5 - ì „ëµì  í•µì‹¬: ì¡°ì§ì˜ ìµœìš°ì„  ëª©í‘œ/KPIì— ì§ê²°</option>
                            <option value="4">4 - ì£¼ìš” ì„±ê³¼: ì¥ê¸°ì ì¸ ì„±ì¥/ì§€ì†ì  ê°œì„ ì— í•„ìˆ˜ì </option>
                            <option value="3" selected>3 - ìš´ì˜ í•„ìˆ˜: íŒ€/ë¶€ì„œì˜ ì¼ìƒì ì¸ í•µì‹¬ í”„ë¡œì„¸ìŠ¤ ìœ ì§€</option>
                            <option value="2">2 - ë³´ì¡°ì  ê°€ì¹˜: ê°œì¸ ì—­ëŸ‰ í–¥ìƒì´ë‚˜ ë¶€ìˆ˜ì  ê°œì„ ì— ê¸°ì—¬</option>
                            <option value="1">1 - ìµœì†Œ ê°€ì¹˜: ê°€ì¹˜ ì°½ì¶œ ê¸°ì—¬ê°€ ë¯¸ë¯¸í•˜ê±°ë‚˜ ë³´ë¥˜ ê°€ëŠ¥</option>
                        </select>
                    </div>

                    <!-- ê¸´ê¸‰ë„ (Urgency) - í™•ì¥ë¨ -->
                    <div>
                        <label for="urgency" class="block text-sm font-medium text-gray-700 mb-1">2. ê¸´ê¸‰ë„ (ë§ˆê° ê¸°í•œ ë° ì§€ì—° ì˜í–¥)</label>
                        <select id="urgency" required class="w-full p-3 border border-indigo-300 rounded-lg bg-white text-sm focus:ring-2 focus:ring-indigo-500">
                            <option value="5">5 - ì¦‰ì‹œ ëŒ€ì‘: ë²•ì /ê³„ì•½ ë§ˆê° ë˜ëŠ” ì‹œìŠ¤í…œ ìœ„ê¸°ë¡œ ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”</option>
                            <option value="4">4 - ì´‰ë°•í•œ ê¸°í•œ: 24ì‹œê°„~48ì‹œê°„ ë‚´ ë§ˆê°, ì§€ì—° ì‹œ ì¦‰ê°ì ì¸ ì†ì‹¤ ë°œìƒ</option>
                            <option value="3" selected>3 - ì¼ì • ë³‘ëª©: ì´ ì—…ë¬´ê°€ í›„ì† ì‘ì—…/ì£¼ìš” ì˜ì‚¬ê²°ì •ì˜ ì„ í–‰ ì¡°ê±´</option>
                            <option value="2">2 - ê³„íšëœ ì¼ì •: 1ì£¼ì¼~1ê°œì›” ì´ë‚´ ë§ˆê°ì´ì§€ë§Œ, ìœ ì—°í•˜ê²Œ ì¡°ì • ê°€ëŠ¥</option>
                            <option value="1">1 - ì—¬ìœ ë¡œì›€: ì¥ê¸°ì  ê³¼ì œ, ê¸°í•œì´ ì—†ê±°ë‚˜ 1ê°œì›” ì´ìƒ ë‚¨ìŒ</option>
                        </select>
                    </div>
                    
                    <!-- ì˜í–¥ë ¥ (Scope of Impact) - í™•ì¥ë¨ -->
                    <div>
                        <label for="impact" class="block text-sm font-medium text-gray-700 mb-1">3. ì˜í–¥ë ¥ (íŒŒê¸‰ ë²”ìœ„ ë° ì°½ì¶œ ê°€ì¹˜)</label>
                        <select id="impact" required class="w-full p-3 border border-indigo-300 rounded-lg bg-white text-sm focus:ring-2 focus:ring-ring-indigo-500">
                            <option value="5">5 - ì „ì‚¬ì  íŒŒê¸‰: ê³ ê°, í•µì‹¬ íŒŒíŠ¸ë„ˆ, ì¡°ì§ ì „ì²´ì˜ ìˆ˜ìµ/í‰íŒì— ë§‰ëŒ€í•œ ì˜í–¥</option>
                            <option value="4">4 - ì£¼ìš” ë¶€ì„œ/íŒ€ ì˜í–¥: ì—¬ëŸ¬ ë¶€ì„œë‚˜ í•µì‹¬ íŒ€ì˜ ì›Œí¬í”Œë¡œìš°ì— í° ê°œì„ ì„ ì¤Œ</option>
                            <option value="3" selected>3 - ê°œì¸/ì†Œê·œëª¨ íŒ€ ì˜í–¥: ì£¼ë¡œ ê°œì¸ì˜ ì„±ê³¼ë‚˜ ì†Œê·œëª¨ íŒ€ ìš´ì˜ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹¨</option>
                            <option value="2">2 - ê°„ì ‘ì  ì˜í–¥: ê²°ê³¼ê°€ í•œì •ì  ê·¸ë£¹ì´ë‚˜ ë¶€ìˆ˜ì ì¸ í”„ë¡œì„¸ìŠ¤ì—ë§Œ ë¯¸ì¹˜ëŠ” ê²½ìš°</option>
                            <option value="1">1 - ì§€ì—­ì /ë‚´ë¶€ì  ì˜í–¥: ì˜í–¥ë ¥ì´ ê±°ì˜ ì—†ëŠ” ë‹¨ìˆœ ë‚´ë¶€ ì„œë¥˜ ì‘ì—…</option>
                        </select>
                    </div>

                    <!-- ë…¸ë ¥/ì†Œìš” ì‹œê°„ (Effort) - í™•ì¥ë¨ (ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ê°ì ) -->
                    <div>
                        <label for="effort" class="block text-sm font-medium text-gray-700 mb-1">4. ë…¸ë ¥/ì†Œìš” ì‹œê°„ (ë³µì¡ì„± ë° ì˜ˆìƒ ì‹œê°„)</label>
                        <select id="effort" required class="w-full p-3 border border-indigo-300 rounded-lg bg-white text-sm focus:ring-2 focus:ring-indigo-500">
                            <option value="5">5 - ë§¤ìš° ë†’ìŒ: ê³ ë„ì˜ ë³µì¡ì„± ë° 1ì£¼ì¼ ì´ìƒ ë˜ëŠ” 40ì‹œê°„ ì´ˆê³¼ ì†Œìš”</option>
                            <option value="4">4 - ë†’ìŒ: ìƒë‹¹í•œ ì§‘ì¤‘ í•„ìš” ë° 3~5ì¼ ë˜ëŠ” 16~40ì‹œê°„ ì†Œìš”</option>
                            <option value="3" selected>3 - ë³´í†µ: í‘œì¤€ì ì¸ ì§‘ì¤‘ í•„ìš” ë° ë°˜ë‚˜ì ˆ~2ì¼ ë˜ëŠ” 4~16ì‹œê°„ ì†Œìš”</option>
                            <option value="2">2 - ë‚®ìŒ: ê°€ë²¼ìš´ ì§‘ì¤‘ í•„ìš” ë° 1ì‹œê°„~4ì‹œê°„ ì†Œìš”</option>
                            <option value="1">1 - ë§¤ìš° ë‚®ìŒ: ë‹¨ìˆœí•˜ê³  ë°˜ë³µì ì´ë©° 1ì‹œê°„ ë¯¸ë§Œ ì†Œìš”</option>
                        </select>
                    </div>
                </div>
                
                <!-- ìƒˆë¡œìš´ ê°€ì¤‘ì¹˜ ì„¤ì • ì„¹ì…˜ -->
                <div class="mt-6 pt-4 border-t border-indigo-200">
                    <h3 class="text-lg font-bold text-indigo-700 mb-3">5. ìš°ì„ ìˆœìœ„ ê°€ì¤‘ì¹˜ ì„¤ì • (W)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div>
                            <label for="importance-weight" class="block text-sm font-medium text-gray-700 mb-1">ì¤‘ìš”ë„ ê°€ì¤‘ì¹˜ (ê¸°ë³¸: 3)</label>
                            <input type="number" id="importance-weight" value="3" min="0" max="10"
                                class="weight-input w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                        </div>
                        <div>
                            <label for="urgency-weight" class="block text-sm font-medium text-gray-700 mb-1">ê¸´ê¸‰ë„ ê°€ì¤‘ì¹˜ (ê¸°ë³¸: 3)</label>
                            <input type="number" id="urgency-weight" value="3" min="0" max="10"
                                class="weight-input w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                        </div>
                        <div>
                            <label for="impact-weight" class="block text-sm font-medium text-gray-700 mb-1">ì˜í–¥ë ¥ ê°€ì¤‘ì¹˜ (ê¸°ë³¸: 2)</label>
                            <input type="number" id="impact-weight" value="2" min="0" max="10"
                                class="weight-input w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                        </div>
                        <div>
                            <label for="effort-weight" class="block text-sm font-medium text-gray-700 mb-1">ë…¸ë ¥ (ê°ì ) ê°€ì¤‘ì¹˜ (ê¸°ë³¸: 1)</label>
                            <input type="number" id="effort-weight" value="1" min="0" max="10"
                                class="weight-input w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                        </div>
                    </div>
                </div>

                <button type="submit"
                    class="w-full py-3 mt-4 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors duration-200 shadow-md">
                    ì—…ë¬´ ì¶”ê°€í•˜ê³  ìš°ì„ ìˆœìœ„ ê³„ì‚°í•˜ê¸°
                </button>
            </form>
            <p id="formula-display" class="text-xs text-gray-500 mt-3" aria-live="polite">
                <!-- Formula will be dynamically updated here -->
                *ìš°ì„ ìˆœìœ„ ì ìˆ˜ = (ì¤‘ìš”ë„ x3) + (ê¸´ê¸‰ë„ x3) + (ì˜í–¥ë ¥ x2) - (ë…¸ë ¥ x1)
            </p>
        </section>

        <!-- 2. ìš°ì„ ìˆœìœ„ ëª©ë¡ (ì‹¤ì‹œê°„ ë°˜ì˜) -->
        <section>
            <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ“‹ í˜„ì¬ ì—…ë¬´ ëª©ë¡ (ìš°ì„ ìˆœìœ„ ì •ë ¬)</h2>
            <div id="task-list-container" class="space-y-4">
                <!-- Tasks will be rendered here dynamically -->
                <p class="text-gray-500 text-center p-8">ë¡œë”© ì¤‘...</p>
            </div>
        </section>
        
        <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ (Confirm ëŒ€ì‹  ì‚¬ìš©) -->
        <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <p id="confirm-text" class="text-lg font-semibold mb-6 text-gray-800">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div class="flex justify-end space-x-3">
                    <button id="confirm-no" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">ì·¨ì†Œ</button>
                    <button id="confirm-yes" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">í™•ì¸</button>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
